# ì›¹ì†Œì¼“ êµ¬í˜„ ê°€ì´ë“œ

# ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë³„ ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“Œ ê°œìš”

ProjecTree í”„ë¡œì íŠ¸ì— ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë³„ ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” êµ¬í˜„ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ¯ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### í•µì‹¬ ê¸°ëŠ¥

- âœ… ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë³„ ë…ë¦½ì ì¸ ì±„íŒ…ë°©
- âœ… ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì†¡ìˆ˜ì‹ 
- âœ… ì°¸ì—¬ì ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œ
- âœ… íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
- âœ… ì½ìŒ ì²˜ë¦¬
- âœ… ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ë¡œë“œ

### ë¶€ê°€ ê¸°ëŠ¥ (ì„ íƒ)

- íŒŒì¼/ì´ë¯¸ì§€ ì „ì†¡
- ë©”ì‹œì§€ ê²€ìƒ‰
- ë©˜ì…˜ ê¸°ëŠ¥
- ìŠ¤ë ˆë“œ ë‹µê¸€

---

## ğŸ“¦ 1ë‹¨ê³„: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

```bash
# Socket.IO í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜
pnpm add socket.io-client

# ìƒíƒœ ê´€ë¦¬ (Zustand)
pnpm add zustand

# ë‚ ì§œ í¬ë§·íŒ… (ì´ë¯¸ ì„¤ì¹˜ë¨)
# date-fns

# íƒ€ì… ì •ì˜
pnpm add -D @types/socket.io-client
```

---

## ğŸ—‚ï¸ 2ë‹¨ê³„: í´ë” êµ¬ì¡° ìƒì„±

```
src/
â”œâ”€â”€ features/
â”‚   â””â”€â”€ chat/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ChatPanel.tsx              # ì±„íŒ… íŒ¨ë„ ì»¨í…Œì´ë„ˆ
â”‚       â”‚   â”œâ”€â”€ ChatHeader.tsx             # ì±„íŒ…ë°© í—¤ë”
â”‚       â”‚   â”œâ”€â”€ ChatMessageList.tsx        # ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸
â”‚       â”‚   â”œâ”€â”€ ChatMessageItem.tsx        # ê°œë³„ ë©”ì‹œì§€
â”‚       â”‚   â”œâ”€â”€ ChatInput.tsx              # ë©”ì‹œì§€ ì…ë ¥ì°½
â”‚       â”‚   â”œâ”€â”€ ChatParticipantList.tsx    # ì°¸ì—¬ì ëª©ë¡
â”‚       â”‚   â”œâ”€â”€ TypingIndicator.tsx        # íƒ€ì´í•‘ í‘œì‹œ
â”‚       â”‚   â””â”€â”€ ChatNotification.tsx       # ì•Œë¦¼ ë°°ì§€
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ useWebSocket.ts            # WebSocket ì—°ê²° ê´€ë¦¬
â”‚       â”‚   â”œâ”€â”€ useChat.ts                 # ì±„íŒ… ë¡œì§
â”‚       â”‚   â”œâ”€â”€ useChatMessages.ts         # ë©”ì‹œì§€ ê´€ë¦¬
â”‚       â”‚   â””â”€â”€ useChatNotification.ts     # ì•Œë¦¼ ê´€ë¦¬
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ chatSocket.ts              # Socket.IO ì„¤ì •
â”‚       â”‚   â””â”€â”€ chatApi.ts                 # REST API (íˆìŠ¤í† ë¦¬ ë¡œë“œ)
â”‚       â”œâ”€â”€ store/
â”‚       â”‚   â””â”€â”€ chatStore.ts               # Zustand ìŠ¤í† ì–´
â”‚       â”œâ”€â”€ types/
â”‚       â”‚   â””â”€â”€ chat.types.ts              # íƒ€ì… ì •ì˜
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ messageFormatter.ts        # ë©”ì‹œì§€ í¬ë§·íŒ…
â”‚           â””â”€â”€ chatHelpers.ts             # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
```

---

## ğŸ“ 3ë‹¨ê³„: íƒ€ì… ì •ì˜

### `src/features/chat/types/chat.types.ts`

```tsx
// ë©”ì‹œì§€ íƒ€ì…
export interface ChatMessage {
  id: string;
  workspaceId: string;
  senderId: string;
  senderName: string;
  senderAvatar?: string;
  content: string;
  timestamp: string; // ISO 8601 í˜•ì‹
  type: "text" | "image" | "file" | "system";
  isRead: boolean;
  readBy: string[]; // ì½ì€ ì‚¬ìš©ì ID ëª©ë¡
}

// ì°¸ì—¬ì ì •ë³´
export interface ChatParticipant {
  id: string;
  name: string;
  email: string;
  avatar?: string;
  role: "owner" | "admin" | "member";
  isOnline: boolean;
  isTyping: boolean;
  lastSeen?: string;
}

// ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„íŒ…ë°©
export interface WorkspaceChatRoom {
  workspaceId: string;
  workspaceName: string;
  participants: ChatParticipant[];
  lastMessage?: ChatMessage;
  unreadCount: number;
  createdAt: string;
}

// Socket ì´ë²¤íŠ¸ íƒ€ì…
export type SocketEvent =
  | "chat:join" // ì±„íŒ…ë°© ì…ì¥
  | "chat:leave" // ì±„íŒ…ë°© í‡´ì¥
  | "message:send" // ë©”ì‹œì§€ ì „ì†¡
  | "message:receive" // ë©”ì‹œì§€ ìˆ˜ì‹ 
  | "message:read" // ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬
  | "typing:start" // íƒ€ì´í•‘ ì‹œì‘
  | "typing:stop" // íƒ€ì´í•‘ ì¢…ë£Œ
  | "user:online" // ì‚¬ìš©ì ì˜¨ë¼ì¸
  | "user:offline" // ì‚¬ìš©ì ì˜¤í”„ë¼ì¸
  | "error"; // ì—ëŸ¬

// Socket ì´ë²¤íŠ¸ í˜ì´ë¡œë“œ
export interface MessageSendPayload {
  workspaceId: string;
  content: string;
  type: "text" | "image" | "file";
}

export interface MessageReceivePayload {
  message: ChatMessage;
}

export interface TypingPayload {
  workspaceId: string;
  userId: string;
  userName: string;
}

export interface UserStatusPayload {
  userId: string;
  isOnline: boolean;
}

// ì±„íŒ… ìƒíƒœ
export interface ChatState {
  // ë©”ì‹œì§€
  messages: Record<string, ChatMessage[]>; // workspaceIdë¥¼ í‚¤ë¡œ ì‚¬ìš©

  // ì°¸ì—¬ì
  participants: Record<string, ChatParticipant[]>;

  // í˜„ì¬ í™œì„± ì›Œí¬ìŠ¤í˜ì´ìŠ¤
  activeWorkspaceId: string | null;

  // íƒ€ì´í•‘ ì¤‘ì¸ ì‚¬ìš©ì
  typingUsers: Record<string, string[]>; // workspaceId -> userIds

  // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜
  unreadCounts: Record<string, number>;

  // ì—°ê²° ìƒíƒœ
  isConnected: boolean;

  // ì•¡ì…˜
  addMessage: (workspaceId: string, message: ChatMessage) => void;
  setMessages: (workspaceId: string, messages: ChatMessage[]) => void;
  markAsRead: (workspaceId: string, messageIds: string[]) => void;
  setParticipants: (
    workspaceId: string,
    participants: ChatParticipant[],
  ) => void;
  updateParticipantStatus: (userId: string, isOnline: boolean) => void;
  setTyping: (workspaceId: string, userId: string, isTyping: boolean) => void;
  setActiveWorkspace: (workspaceId: string | null) => void;
  setConnected: (isConnected: boolean) => void;
  clearWorkspaceMessages: (workspaceId: string) => void;
}
```

---

## ğŸ”Œ 4ë‹¨ê³„: WebSocket ì„œë¹„ìŠ¤ êµ¬í˜„

### `src/features/chat/services/chatSocket.ts`

```tsx
import { io, Socket } from "socket.io-client";

class ChatSocketService {
  private socket: Socket | null = null;
  private readonly serverUrl: string;

  constructor() {
    // í™˜ê²½ë³€ìˆ˜ì—ì„œ WebSocket ì„œë²„ URL ê°€ì ¸ì˜¤ê¸°
    this.serverUrl = import.meta.env.VITE_WS_URL || "ws://localhost:3000";
  }

  /**
   * WebSocket ì—°ê²° ì´ˆê¸°í™”
   */
  connect(token: string): Socket {
    if (this.socket?.connected) {
      return this.socket;
    }

    this.socket = io(this.serverUrl, {
      auth: {
        token, // JWT í† í° ì „ë‹¬
      },
      transports: ["websocket", "polling"],
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionAttempts: 5,
    });

    // ì—°ê²° ì´ë²¤íŠ¸
    this.socket.on("connect", () => {
      console.log("âœ… WebSocket connected:", this.socket?.id);
    });

    this.socket.on("disconnect", (reason) => {
      console.log("âŒ WebSocket disconnected:", reason);
    });

    this.socket.on("connect_error", (error) => {
      console.error("ğŸ”´ Connection error:", error);
    });

    return this.socket;
  }

  /**
   * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„íŒ…ë°© ì…ì¥
   */
  joinWorkspace(workspaceId: string): void {
    if (!this.socket) {
      throw new Error("Socket not connected");
    }
    this.socket.emit("chat:join", { workspaceId });
  }

  /**
   * ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„íŒ…ë°© í‡´ì¥
   */
  leaveWorkspace(workspaceId: string): void {
    if (!this.socket) return;
    this.socket.emit("chat:leave", { workspaceId });
  }

  /**
   * ë©”ì‹œì§€ ì „ì†¡
   */
  sendMessage(
    workspaceId: string,
    content: string,
    type: "text" | "image" | "file" = "text",
  ): void {
    if (!this.socket) {
      throw new Error("Socket not connected");
    }
    this.socket.emit("message:send", {
      workspaceId,
      content,
      type,
    });
  }

  /**
   * ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬
   */
  markAsRead(workspaceId: string, messageIds: string[]): void {
    if (!this.socket) return;
    this.socket.emit("message:read", { workspaceId, messageIds });
  }

  /**
   * íƒ€ì´í•‘ ì‹œì‘
   */
  startTyping(workspaceId: string): void {
    if (!this.socket) return;
    this.socket.emit("typing:start", { workspaceId });
  }

  /**
   * íƒ€ì´í•‘ ì¢…ë£Œ
   */
  stopTyping(workspaceId: string): void {
    if (!this.socket) return;
    this.socket.emit("typing:stop", { workspaceId });
  }

  /**
   * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
   */
  on(event: string, callback: (...args: any[]) => void): void {
    this.socket?.on(event, callback);
  }

  /**
   * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
   */
  off(event: string, callback?: (...args: any[]) => void): void {
    this.socket?.off(event, callback);
  }

  /**
   * ì—°ê²° í•´ì œ
   */
  disconnect(): void {
    if (this.socket) {
      this.socket.disconnect();
      this.socket = null;
    }
  }

  /**
   * ì—°ê²° ìƒíƒœ í™•ì¸
   */
  isConnected(): boolean {
    return this.socket?.connected ?? false;
  }

  /**
   * Socket ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜
   */
  getSocket(): Socket | null {
    return this.socket;
  }
}

// ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
export const chatSocket = new ChatSocketService();
```

---

## ğŸ—„ï¸ 5ë‹¨ê³„: Zustand ìŠ¤í† ì–´ êµ¬í˜„

### `src/features/chat/store/chatStore.ts`

```tsx
import { create } from "zustand";
import { ChatState, ChatMessage, ChatParticipant } from "../types/chat.types";

export const useChatStore = create<ChatState>((set, get) => ({
  messages: {},
  participants: {},
  activeWorkspaceId: null,
  typingUsers: {},
  unreadCounts: {},
  isConnected: false,

  // ë©”ì‹œì§€ ì¶”ê°€
  addMessage: (workspaceId, message) => {
    set((state) => ({
      messages: {
        ...state.messages,
        [workspaceId]: [...(state.messages[workspaceId] || []), message],
      },
    }));

    // í˜„ì¬ í™œì„± ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ì•„ë‹ˆë©´ ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ì¹´ìš´íŠ¸ ì¦ê°€
    const { activeWorkspaceId } = get();
    if (activeWorkspaceId !== workspaceId) {
      set((state) => ({
        unreadCounts: {
          ...state.unreadCounts,
          [workspaceId]: (state.unreadCounts[workspaceId] || 0) + 1,
        },
      }));
    }
  },

  // ë©”ì‹œì§€ ëª©ë¡ ì„¤ì • (íˆìŠ¤í† ë¦¬ ë¡œë“œ ì‹œ)
  setMessages: (workspaceId, messages) => {
    set((state) => ({
      messages: {
        ...state.messages,
        [workspaceId]: messages,
      },
    }));
  },

  // ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬
  markAsRead: (workspaceId, messageIds) => {
    set((state) => {
      const workspaceMessages = state.messages[workspaceId] || [];
      const updatedMessages = workspaceMessages.map((msg) =>
        messageIds.includes(msg.id) ? { ...msg, isRead: true } : msg,
      );

      return {
        messages: {
          ...state.messages,
          [workspaceId]: updatedMessages,
        },
        unreadCounts: {
          ...state.unreadCounts,
          [workspaceId]: 0,
        },
      };
    });
  },

  // ì°¸ì—¬ì ëª©ë¡ ì„¤ì •
  setParticipants: (workspaceId, participants) => {
    set((state) => ({
      participants: {
        ...state.participants,
        [workspaceId]: participants,
      },
    }));
  },

  // ì°¸ì—¬ì ì˜¨ë¼ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
  updateParticipantStatus: (userId, isOnline) => {
    set((state) => {
      const updatedParticipants = { ...state.participants };

      Object.keys(updatedParticipants).forEach((workspaceId) => {
        updatedParticipants[workspaceId] = updatedParticipants[workspaceId].map(
          (p) => (p.id === userId ? { ...p, isOnline } : p),
        );
      });

      return { participants: updatedParticipants };
    });
  },

  // íƒ€ì´í•‘ ìƒíƒœ ì„¤ì •
  setTyping: (workspaceId, userId, isTyping) => {
    set((state) => {
      const currentTyping = state.typingUsers[workspaceId] || [];
      const updatedTyping = isTyping
        ? [...currentTyping.filter((id) => id !== userId), userId]
        : currentTyping.filter((id) => id !== userId);

      return {
        typingUsers: {
          ...state.typingUsers,
          [workspaceId]: updatedTyping,
        },
      };
    });
  },

  // í™œì„± ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì •
  setActiveWorkspace: (workspaceId) => {
    set({ activeWorkspaceId: workspaceId });

    // í™œì„± ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
    if (workspaceId) {
      set((state) => ({
        unreadCounts: {
          ...state.unreadCounts,
          [workspaceId]: 0,
        },
      }));
    }
  },

  // ì—°ê²° ìƒíƒœ ì„¤ì •
  setConnected: (isConnected) => {
    set({ isConnected });
  },

  // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë©”ì‹œì§€ ì´ˆê¸°í™”
  clearWorkspaceMessages: (workspaceId) => {
    set((state) => {
      const { [workspaceId]: _, ...remainingMessages } = state.messages;
      return { messages: remainingMessages };
    });
  },
}));
```

---

## ğŸª 6ë‹¨ê³„: ì»¤ìŠ¤í…€ í›… êµ¬í˜„

### `src/features/chat/hooks/useWebSocket.ts`

```tsx
import { useEffect, useCallback } from "react";
import { chatSocket } from "../services/chatSocket";
import { useChatStore } from "../store/chatStore";
import {
  ChatMessage,
  TypingPayload,
  UserStatusPayload,
} from "../types/chat.types";

export const useWebSocket = (workspaceId: string | null) => {
  const {
    addMessage,
    setTyping,
    updateParticipantStatus,
    setConnected,
    setActiveWorkspace,
  } = useChatStore();

  // WebSocket ì—°ê²°
  useEffect(() => {
    //TODO: ì‹¤ì œ JWT í† í° ê°€ì ¸ì˜¤ê¸° (ì˜ˆ: localStorage, Context ë“±)
    const token = localStorage.getItem("authToken") || "";

    const socket = chatSocket.connect(token);

    // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
    socket.on("connect", () => {
      setConnected(true);
    });

    socket.on("disconnect", () => {
      setConnected(false);
    });

    return () => {
      chatSocket.disconnect();
      setConnected(false);
    };
  }, [setConnected]);

  // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì…ì¥/í‡´ì¥
  useEffect(() => {
    if (!workspaceId) return;

    chatSocket.joinWorkspace(workspaceId);
    setActiveWorkspace(workspaceId);

    return () => {
      chatSocket.leaveWorkspace(workspaceId);
      setActiveWorkspace(null);
    };
  }, [workspaceId, setActiveWorkspace]);

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  useEffect(() => {
    if (!workspaceId) return;

    // ë©”ì‹œì§€ ìˆ˜ì‹ 
    const handleMessageReceive = (data: { message: ChatMessage }) => {
      addMessage(workspaceId, data.message);
    };

    // íƒ€ì´í•‘ ì‹œì‘
    const handleTypingStart = (data: TypingPayload) => {
      if (data.workspaceId === workspaceId) {
        setTyping(workspaceId, data.userId, true);
      }
    };

    // íƒ€ì´í•‘ ì¢…ë£Œ
    const handleTypingStop = (data: TypingPayload) => {
      if (data.workspaceId === workspaceId) {
        setTyping(workspaceId, data.userId, false);
      }
    };

    // ì‚¬ìš©ì ì˜¨ë¼ì¸ ìƒíƒœ
    const handleUserOnline = (data: UserStatusPayload) => {
      updateParticipantStatus(data.userId, true);
    };

    const handleUserOffline = (data: UserStatusPayload) => {
      updateParticipantStatus(data.userId, false);
    };

    // ì—ëŸ¬ ì²˜ë¦¬
    const handleError = (error: any) => {
      console.error("Socket error:", error);
    };

    chatSocket.on("message:receive", handleMessageReceive);
    chatSocket.on("typing:start", handleTypingStart);
    chatSocket.on("typing:stop", handleTypingStop);
    chatSocket.on("user:online", handleUserOnline);
    chatSocket.on("user:offline", handleUserOffline);
    chatSocket.on("error", handleError);

    return () => {
      chatSocket.off("message:receive", handleMessageReceive);
      chatSocket.off("typing:start", handleTypingStart);
      chatSocket.off("typing:stop", handleTypingStop);
      chatSocket.off("user:online", handleUserOnline);
      chatSocket.off("user:offline", handleUserOffline);
      chatSocket.off("error", handleError);
    };
  }, [workspaceId, addMessage, setTyping, updateParticipantStatus]);

  // ë©”ì‹œì§€ ì „ì†¡
  const sendMessage = useCallback(
    (content: string) => {
      if (!workspaceId || !content.trim()) return;
      chatSocket.sendMessage(workspaceId, content.trim());
    },
    [workspaceId],
  );

  // íƒ€ì´í•‘ ì‹œì‘
  const startTyping = useCallback(() => {
    if (!workspaceId) return;
    chatSocket.startTyping(workspaceId);
  }, [workspaceId]);

  // íƒ€ì´í•‘ ì¢…ë£Œ
  const stopTyping = useCallback(() => {
    if (!workspaceId) return;
    chatSocket.stopTyping(workspaceId);
  }, [workspaceId]);

  return {
    sendMessage,
    startTyping,
    stopTyping,
    isConnected: useChatStore((state) => state.isConnected),
  };
};
```

### `src/features/chat/hooks/useChat.ts`

```tsx
import { useEffect } from "react";
import { useChatStore } from "../store/chatStore";
import { useWebSocket } from "./useWebSocket";

export const useChat = (workspaceId: string) => {
  const { sendMessage, startTyping, stopTyping, isConnected } =
    useWebSocket(workspaceId);

  const messages = useChatStore((state) => state.messages[workspaceId] || []);
  const participants = useChatStore(
    (state) => state.participants[workspaceId] || [],
  );
  const typingUsers = useChatStore(
    (state) => state.typingUsers[workspaceId] || [],
  );
  const unreadCount = useChatStore(
    (state) => state.unreadCounts[workspaceId] || 0,
  );

  //TODO: ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ë¡œë“œ (REST API)
  useEffect(() => {
    // fetchMessageHistory(workspaceId);
  }, [workspaceId]);

  return {
    messages,
    participants,
    typingUsers,
    unreadCount,
    isConnected,
    sendMessage,
    startTyping,
    stopTyping,
  };
};
```

---

## ğŸ¨ 7ë‹¨ê³„: UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

### `src/features/chat/components/ChatPanel.tsx`

```tsx
import { useState } from 'react';
import { useChat } from '../hooks/useChat';
import { ChatHeader } from './ChatHeader';
import { ChatMessageList } from './ChatMessageList';
import { ChatInput } from './ChatInput';
import { ChatParticipantList } from './ChatParticipantList';

interface ChatPanelProps {
  workspaceId: string;
  workspaceName: string;
}

export const ChatPanel = ({ workspaceId, workspaceName }: ChatPanelProps) => {
  const [showParticipants, setShowParticipants] = useState(false);
  const {
    messages,
    participants,
    typingUsers,
    isConnected,
    sendMessage,
    startTyping,
    stopTyping,
  } = useChat(workspaceId);

  return (
    <div className="flex h-full flex-col bg-white">
      {/* í—¤ë” */}
      <ChatHeader
        workspaceName={workspaceName}
        participantCount={participants.length}
        isConnected={isConnected}
        onToggleParticipants={() => setShowParticipants(!showParticipants)}
      />

      <div className="flex flex-1 overflow-hidden">
        {/* ë©”ì‹œì§€ ì˜ì—­ */}
        <div className="flex flex-1 flex-col">
          <ChatMessageList messages={messages} typingUsers={typingUsers} />
          <ChatInput
            onSendMessage={sendMessage}
            onStartTyping={startTyping}
            onStopTyping={stopTyping}
            disabled={!isConnected}
          />
        </div>

        {/* ì°¸ì—¬ì ëª©ë¡ (í† ê¸€) */}
        {showParticipants && (
          <div className="w-64 border-l border-gray-200">
            <ChatParticipantList participants={participants} />
          </div>
        )}
      </div>
    </div>
  );
};
```

### `src/features/chat/components/ChatHeader.tsx`

```tsx
import { Users, Wifi, WifiOff } from 'lucide-react';

interface ChatHeaderProps {
  workspaceName: string;
  participantCount: number;
  isConnected: boolean;
  onToggleParticipants: () => void;
}

export const ChatHeader = ({
  workspaceName,
  participantCount,
  isConnected,
  onToggleParticipants,
}: ChatHeaderProps) => {
  return (
    <div className="flex items-center justify-between border-b border-gray-200 px-4 py-3">
      <div className="flex items-center gap-2">
        <h2 className="text-lg font-semibold text-gray-900">{workspaceName}</h2>
        {isConnected ? (
          <Wifi className="h-4 w-4 text-green-500" />
        ) : (
          <WifiOff className="h-4 w-4 text-red-500" />
        )}
      </div>

      <button
        onClick={onToggleParticipants}
        className="flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100"
      >
        <Users className="h-4 w-4" />
        <span>{participantCount}</span>
      </button>
    </div>
  );
};
```

### `src/features/chat/components/ChatMessageList.tsx`

```tsx
import { useEffect, useRef } from 'react';
import { ChatMessage } from '../types/chat.types';
import { ChatMessageItem } from './ChatMessageItem';
import { TypingIndicator } from './TypingIndicator';

interface ChatMessageListProps {
  messages: ChatMessage[];
  typingUsers: string[];
}

export const ChatMessageList = ({ messages, typingUsers }: ChatMessageListProps) => {
  const bottomRef = useRef<HTMLDivElement>(null);

  // ìƒˆ ë©”ì‹œì§€ ë„ì°© ì‹œ ìë™ ìŠ¤í¬ë¡¤
  useEffect(() => {
    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  return (
    <div className="flex-1 overflow-y-auto px-4 py-4">
      {messages.length === 0 ? (
        <div className="flex h-full items-center justify-center text-gray-400">
          <p>ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”!</p>
        </div>
      ) : (
        <div className="space-y-4">
          {messages.map((message) => (
            <ChatMessageItem key={message.id} message={message} />
          ))}
          {typingUsers.length > 0 && <TypingIndicator userCount={typingUsers.length} />}
          <div ref={bottomRef} />
        </div>
      )}
    </div>
  );
};
```

### `src/features/chat/components/ChatMessageItem.tsx`

```tsx
import { format } from 'date-fns';
import { ko } from 'date-fns/locale';
import { ChatMessage } from '../types/chat.types';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';

interface ChatMessageItemProps {
  message: ChatMessage;
}

export const ChatMessageItem = ({ message }: ChatMessageItemProps) => {
  const isCurrentUser = false; //TODO: í˜„ì¬ ì‚¬ìš©ì í™•ì¸ ë¡œì§
  const timestamp = format(new Date(message.timestamp), 'a h:mm', { locale: ko });

  return (
    <div className={`flex gap-3${isCurrentUser ? 'flex-row-reverse' : ''}`}>
      {/* ì•„ë°”íƒ€ */}
      <Avatar className="h-8 w-8">
        <AvatarImage src={message.senderAvatar} alt={message.senderName} />
        <AvatarFallback>{message.senderName[0]}</AvatarFallback>
      </Avatar>

      {/* ë©”ì‹œì§€ ë‚´ìš© */}
      <div className={`flex flex-col${isCurrentUser ? 'items-end' : ''}`}>
        <div className="mb-1 flex items-center gap-2">
          <span className="text-sm font-medium text-gray-900">{message.senderName}</span>
          <span className="text-xs text-gray-500">{timestamp}</span>
        </div>
        <div
          className={`max-w-md rounded-lg px-4 py-2${
            isCurrentUser
              ? 'bg-blue-500 text-white'
              : 'bg-gray-100 text-gray-900'
          }`}
        >
          <p className="whitespace-pre-wrap break-words text-sm">{message.content}</p>
        </div>
      </div>
    </div>
  );
};
```

### `src/features/chat/components/ChatInput.tsx`

```tsx
import { useState, useRef, useCallback } from 'react';
import { Send } from 'lucide-react';

interface ChatInputProps {
  onSendMessage: (content: string) => void;
  onStartTyping: () => void;
  onStopTyping: () => void;
  disabled?: boolean;
}

export const ChatInput = ({
  onSendMessage,
  onStartTyping,
  onStopTyping,
  disabled = false,
}: ChatInputProps) => {
  const [message, setMessage] = useState('');
  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    setMessage(e.target.value);

    // íƒ€ì´í•‘ ì‹œì‘
    if (e.target.value.length === 1) {
      onStartTyping();
    }

    // íƒ€ì´í•‘ ì¢…ë£Œ ë””ë°”ìš´ì‹±
    if (typingTimeoutRef.current) {
      clearTimeout(typingTimeoutRef.current);
    }
    typingTimeoutRef.current = setTimeout(() => {
      onStopTyping();
    }, 1000);
  };

  const handleSubmit = useCallback(
    (e: React.FormEvent) => {
      e.preventDefault();
      if (!message.trim() || disabled) return;

      onSendMessage(message);
      setMessage('');
      onStopTyping();

      if (typingTimeoutRef.current) {
        clearTimeout(typingTimeoutRef.current);
      }
    },
    [message, disabled, onSendMessage, onStopTyping]
  );

  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSubmit(e);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="border-t border-gray-200 p-4">
      <div className="flex items-end gap-2">
        <textarea
          value={message}
          onChange={handleInputChange}
          onKeyDown={handleKeyDown}
          placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”... (Shift+Enterë¡œ ì¤„ë°”ê¿ˆ)"
          disabled={disabled}
          rows={1}
          className="flex-1 resize-none rounded-lg border border-gray-300 px-4 py-2 text-sm focus:border-blue-500 focus:outline-none disabled:bg-gray-100"
        />
        <button
          type="submit"
          disabled={!message.trim() || disabled}
          className="rounded-lg bg-blue-500 p-2 text-white hover:bg-blue-600 disabled:bg-gray-300"
        >
          <Send className="h-5 w-5" />
        </button>
      </div>
    </form>
  );
};
```

### `src/features/chat/components/TypingIndicator.tsx`

```tsx
interface TypingIndicatorProps {
  userCount: number;
}

export const TypingIndicator = ({ userCount }: TypingIndicatorProps) => {
  return (
    <div className="flex items-center gap-2 text-sm text-gray-500">
      <div className="flex gap-1">
        <span className="h-2 w-2 animate-bounce rounded-full bg-gray-400" style={{ animationDelay: '0ms' }} />
        <span className="h-2 w-2 animate-bounce rounded-full bg-gray-400" style={{ animationDelay: '150ms' }} />
        <span className="h-2 w-2 animate-bounce rounded-full bg-gray-400" style={{ animationDelay: '300ms' }} />
      </div>
      <span>{userCount}ëª…ì´ ì…ë ¥ ì¤‘...</span>
    </div>
  );
};
```

### `src/features/chat/components/ChatParticipantList.tsx`

```tsx
import { ChatParticipant } from '../types/chat.types';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';

interface ChatParticipantListProps {
  participants: ChatParticipant[];
}

export const ChatParticipantList = ({ participants }: ChatParticipantListProps) => {
  const onlineCount = participants.filter((p) => p.isOnline).length;

  return (
    <div className="flex h-full flex-col">
      <div className="border-b border-gray-200 px-4 py-3">
        <h3 className="text-sm font-semibold text-gray-900">
          ì°¸ì—¬ì ({onlineCount}/{participants.length})
        </h3>
      </div>

      <div className="flex-1 overflow-y-auto p-2">
        {participants.map((participant) => (
          <div
            key={participant.id}
            className="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-gray-50"
          >
            <div className="relative">
              <Avatar className="h-8 w-8">
                <AvatarImage src={participant.avatar} alt={participant.name} />
                <AvatarFallback>{participant.name[0]}</AvatarFallback>
              </Avatar>
              {participant.isOnline && (
                <span className="absolute bottom-0 right-0 h-2.5 w-2.5 rounded-full border-2 border-white bg-green-500" />
              )}
            </div>
            <div className="flex-1">
              <p className="text-sm font-medium text-gray-900">{participant.name}</p>
              <p className="text-xs text-gray-500">{participant.role}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

---

## ğŸ”— 8ë‹¨ê³„: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í˜ì´ì§€ì— í†µí•©

### ì˜ˆì‹œ: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í˜ì´ì§€ì— ì±„íŒ… íŒ¨ë„ ì¶”ê°€

```tsx
// src/pages/workspace/WorkspacePage.tsx
import { useState } from 'react';
import { useParams } from 'react-router-dom';
import { ChatPanel } from '@/features/chat/components/ChatPanel';
import { MessageSquare } from 'lucide-react';

export const WorkspacePage = () => {
  const { workspaceId } = useParams<{ workspaceId: string }>();
  const [showChat, setShowChat] = useState(false);

  return (
    <div className="flex h-screen">
      {/* ë©”ì¸ ì½˜í…ì¸  */}
      <div className="flex-1">
        {/* ê¸°ì¡´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì½˜í…ì¸  */}
      </div>

      {/* ì±„íŒ… í† ê¸€ ë²„íŠ¼ */}
      <button
        onClick={() => setShowChat(!showChat)}
        className="fixed bottom-6 right-6 rounded-full bg-blue-500 p-4 text-white shadow-lg hover:bg-blue-600"
      >
        <MessageSquare className="h-6 w-6" />
      </button>

      {/* ì±„íŒ… íŒ¨ë„ (ìŠ¬ë¼ì´ë“œ) */}
      {showChat && (
        <div className="w-96 border-l border-gray-200 shadow-xl">
          <ChatPanel
            workspaceId={workspaceId!}
            workspaceName="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ë¦„" //TODO: ì‹¤ì œ ë°ì´í„°
          />
        </div>
      )}
    </div>
  );
};
```

---

## ğŸŒ 9ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### `.env` íŒŒì¼ ìƒì„±

```
# WebSocket ì„œë²„ URL
VITE_WS_URL=ws://localhost:3000

# ë˜ëŠ” í”„ë¡œë•ì…˜
# VITE_WS_URL=wss://api.projectree.com
```

---

## ğŸ§ª 10ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…

### MSWë¡œ WebSocket Mocking (ì„ íƒ)

```tsx
// src/mocks/chatHandlers.ts
import { setupWorker } from "msw/browser";

// WebSocket mockingì€ MSW 2.xì—ì„œ ì‹¤í—˜ì  ê¸°ëŠ¥
// ì‹¤ì œ ë°±ì—”ë“œ ê°œë°œ ì „ê¹Œì§€ëŠ” ë¡œì»¬ Socket.IO ì„œë²„ ì‚¬ìš© ê¶Œì¥
```

### ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© Socket.IO ì„œë²„ (Node.js)

```jsx
// test-server.js
const { Server } = require("socket.io");
const io = new Server(3000, {
  cors: { origin: "*" },
});

io.on("connection", (socket) => {
  console.log("User connected:", socket.id);

  socket.on("chat:join", ({ workspaceId }) => {
    socket.join(workspaceId);
    console.log(`User joined workspace:${workspaceId}`);
  });

  socket.on("message:send", ({ workspaceId, content }) => {
    const message = {
      id: Date.now().toString(),
      workspaceId,
      senderId: socket.id,
      senderName: "Test User",
      content,
      timestamp: new Date().toISOString(),
      type: "text",
      isRead: false,
      readBy: [],
    };
    io.to(workspaceId).emit("message:receive", { message });
  });

  socket.on("disconnect", () => {
    console.log("User disconnected:", socket.id);
  });
});
```

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ]  Socket.IO í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜
- [ ]  Zustand ì„¤ì¹˜
- [ ]  í´ë” êµ¬ì¡° ìƒì„±
- [ ]  íƒ€ì… ì •ì˜ ì‘ì„±
- [ ]  WebSocket ì„œë¹„ìŠ¤ êµ¬í˜„
- [ ]  Zustand ìŠ¤í† ì–´ êµ¬í˜„
- [ ]  ì»¤ìŠ¤í…€ í›… êµ¬í˜„
- [ ]  UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ]  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í˜ì´ì§€ì— í†µí•©
- [ ]  í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ]  ë°±ì—”ë“œ API ì—°ë™
- [ ]  í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥**: ì´ë¯¸ì§€/íŒŒì¼ ì—…ë¡œë“œ ë° ë¯¸ë¦¬ë³´ê¸°
2. **ì•Œë¦¼ ê¸°ëŠ¥**: ë¸Œë¼ìš°ì € ì•Œë¦¼ (Notification API)
3. **ë©”ì‹œì§€ ê²€ìƒ‰**: ì „ì²´ ë©”ì‹œì§€ ê²€ìƒ‰ ê¸°ëŠ¥
4. **ë©˜ì…˜ ê¸°ëŠ¥**: @username ë©˜ì…˜
5. **ìŠ¤ë ˆë“œ ë‹µê¸€**: íŠ¹ì • ë©”ì‹œì§€ì— ë‹µê¸€
6. **ë©”ì‹œì§€ í¸ì§‘/ì‚­ì œ**: ì „ì†¡í•œ ë©”ì‹œì§€ ìˆ˜ì •/ì‚­ì œ
7. **ì´ëª¨ì§€ ë°˜ì‘**: ë©”ì‹œì§€ì— ì´ëª¨ì§€ ë°˜ì‘

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Socket.IO ê³µì‹ ë¬¸ì„œ](https://socket.io/docs/v4/)
- [Zustand ê³µì‹ ë¬¸ì„œ](https://zustand-demo.pmnd.rs/)
- [React WebSocket íŒ¨í„´](https://react.dev/learn/synchronizing-with-effects)